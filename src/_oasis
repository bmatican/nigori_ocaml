OASISFormat: 0.3
Name:        nigori
Version:     0.1
Synopsis:    The Nigori encrypted KV store.
Authors:     Bogdan-Alexandru Matican
License:     Apache
BuildTools:  ocamlbuild

# Libraries 
Library crypto
  Modules:            Constants, 
                      Primitives, 
                      Derivations
  BuildDepends:       cryptokit, 
                      gmp
  Path:               common/crypto/
  Install:            false

Library common
  Modules:            Revision,
                      Nonce,
                      Messages,
                      Messages_t,
                      Messages_j
  BuildDepends:       crypto,
                      atdgen, 
                      yojson,
                      cohttp
  Path:               common/
  Install:            false

Library client 
  Modules:            Client_unix
  BuildDepends:       common,
                      crypto,
                      lwt.unix,
                      lwt, 
                      lwt.syntax, 
                      cohttp, 
                      cohttp.lwt
  Path:               client/
  Install:            false

Library server
  Modules:            Endpoint,
                      User,
                      Database,
                      Server_unix
  BuildDepends:       common, 
                      crypto,
                      lwt.unix,
                      lwt, 
                      lwt.syntax, 
                      cohttp, 
                      cohttp.lwt
  Path:               server/
  Install:            false

Library test
  Modules:            Common
  BuildDepends:       common,
                      crypto
  Path:               test/
  Install:            false

# Main executable
Executable nigori_server
  Path:               .
  MainIs:             nigori_server.ml
  BuildDepends:       common, 
                      crypto,
                      server
  Install:            false
 
Executable nigori_client
  Path:               .
  MainIs:             nigori_client.ml
  BuildDepends:       common, 
                      crypto,
                      client
  Install:            false
 
# Tests
Executable test_primitives
  Path:               test/
  MainIs:             test_primitives.ml
  BuildDepends:       crypto, 
                      test,
                      oUnit 
  Install:            false

Test test_primitives
  Run:                true
  Command:            $test_primitives

Executable test_utils
  Path:               test/
  MainIs:             test_utils.ml
  BuildDepends:       crypto, 
                      test,
                      oUnit
  Install:            false

Test test_utils
  Run:                true
  Command:            $test_utils

Executable test_database
  Path:               test/
  MainIs:             test_database.ml
  BuildDepends:       test,
                      oUnit,
                      server
  Install:            false

Test test_database
  Run:                true
  Command:            $test_database
